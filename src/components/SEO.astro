---
import { siteConfig } from '@/config/site';

export interface Props {
  title?: string;
  description?: string;
  image?: string;
  canonical?: string;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
  authors?: string[];
  tags?: string[];
  noindex?: boolean;
  nofollow?: boolean;
}

const {
  title = siteConfig.title,
  description = siteConfig.description,
  image = '/og-image.svg',
  canonical,
  type = 'website',
  publishedTime,
  modifiedTime,
  authors = [],
  tags = [],
  noindex = false,
  nofollow = false,
} = Astro.props;

const canonicalURL = canonical
  ? new URL(canonical, Astro.site)
  : new URL(Astro.url.pathname, Astro.site);
const imageURL = new URL(image, Astro.site);

// JSON-LD structured data
const structuredData = {
  '@context': 'https://schema.org',
  '@type': type === 'article' ? 'BlogPosting' : 'WebSite',
  name: title,
  headline: title,
  description: description,
  url: canonicalURL,
  image: imageURL,
  ...(type === 'article' && {
    datePublished: publishedTime,
    dateModified: modifiedTime || publishedTime,
    author: authors.map((author: string) => ({
      '@type': 'Person',
      name: author,
    })),
    keywords: tags.join(', '),
  }),
  publisher: {
    '@type': 'Organization',
    name: siteConfig.title,
    url: Astro.site,
  },
};
---

<!-- Primary Meta Tags -->
<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<meta name="keywords" content={tags.join(', ')} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={type} />
<meta property="og:url" content={canonicalURL} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={imageURL} />
<meta property="og:site_name" content={siteConfig.title} />
<meta property="og:locale" content="en_US" />

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image" />
<meta property="twitter:url" content={canonicalURL} />
<meta property="twitter:title" content={title} />
<meta property="twitter:description" content={description} />
<meta property="twitter:image" content={imageURL} />
<meta property="twitter:site" content={siteConfig.seo.twitterHandle || ''} />
<meta property="twitter:creator" content={siteConfig.seo.twitterHandle || ''} />

<!-- Canonical URL -->
{canonical && <link rel="canonical" href={canonicalURL} />}

<!-- Robots -->
{
  (noindex || nofollow) && (
    <meta
      name="robots"
      content={`${noindex ? 'noindex' : 'index'}, ${nofollow ? 'nofollow' : 'follow'}`}
    />
  )
}

<!-- Additional SEO -->
<meta name="author" content={authors.join(', ') || siteConfig.author.name} />
<meta name="copyright" content={siteConfig.title} />
<meta
  name="robots"
  content="max-snippet:-1, max-image-preview:large, max-video-preview:-1"
/>

<!-- JSON-LD structured data -->
<script
  type="application/ld+json"
  set:html={JSON.stringify(structuredData, null, 2)}
  is:inline
/>

<!-- Preconnect to external domains -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
<link rel="apple-touch-icon" href="/apple-touch-icon.svg" />
<link rel="manifest" href="/site.webmanifest" />

<!-- RSS Feed -->
<link
  rel="alternate"
  type="application/rss+xml"
  title={`${siteConfig.title} RSS Feed`}
  href="/rss.xml"
/>
