---
import { siteConfig } from '@/config/site';

export interface Props {
  slug: string;
  title: string;
}

const { slug: _slug, title: _title } = Astro.props;

// Use giscus configuration from site config
const _giscusConfig = {
  repo: siteConfig.giscus.repo,
  repoId: siteConfig.giscus.repoId,
  category: siteConfig.giscus.category,
  categoryId: siteConfig.giscus.categoryId,
  mapping: siteConfig.giscus.mapping,
  reactionsEnabled: siteConfig.giscus.reactionsEnabled,
  emitMetadata: siteConfig.giscus.emitMetadata,
  inputPosition: 'top',
  theme: siteConfig.giscus.theme,
  lang: 'en',
  loading: 'lazy',
};
---

<div class="mt-12 border-t pt-12">
  <h2 class="mb-6 text-2xl font-bold">Comments</h2>
  <div id="giscus-container"></div>
</div>

<script define:vars={{ giscusConfig: _giscusConfig, slug: _slug, title: _title }} is:inline>
  // Load Giscus script
  function loadGiscus() {
    const script = document.createElement('script');
    script.src = 'https://giscus.app/client.js';
    script.setAttribute('data-repo', giscusConfig.repo);
    script.setAttribute('data-repo-id', giscusConfig.repoId);
    script.setAttribute('data-category', giscusConfig.category);
    script.setAttribute('data-category-id', giscusConfig.categoryId);
    script.setAttribute('data-mapping', giscusConfig.mapping);
    script.setAttribute(
      'data-reactions-enabled',
      giscusConfig.reactionsEnabled
    );
    script.setAttribute('data-emit-metadata', giscusConfig.emitMetadata);
    script.setAttribute('data-input-position', giscusConfig.inputPosition);
    script.setAttribute('data-theme', giscusConfig.theme);
    script.setAttribute('data-lang', giscusConfig.lang);
    script.setAttribute('data-loading', giscusConfig.loading);
    script.crossOrigin = 'anonymous';
    script.async = true;

    const container = document.getElementById('giscus-container');
    if (container) {
      container.appendChild(script);
    }
  }

  // Check if Giscus is already loaded
  if (!document.querySelector('script[src="https://giscus.app/client.js"]')) {
    loadGiscus();
  }
</script>
