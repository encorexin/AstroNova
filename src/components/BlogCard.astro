---
import { Image } from 'astro:assets';
import type { CollectionEntry } from 'astro:content';
import { formatDate } from '@/utils/date';

export interface Props {
  post: CollectionEntry<'blog'>;
  variant?: 'default' | 'compact';
}

const { post, variant = 'default' } = Astro.props;
const { title, description, heroImage, publishedAt, tags, category } =
  post.data;
const isPinned = post.data.pinned;
---

<article
  class={`group relative overflow-hidden rounded-lg border bg-card text-card-foreground shadow-sm transition-all hover:shadow-lg ${
    variant === 'compact' ? 'p-4' : 'p-6'
  } ${isPinned ? 'ring-2 ring-primary/50 border-primary/30' : ''}`}
>
  {/* Pinned badge */}
  {
    isPinned && (
      <div class="absolute right-3 top-3 z-10 flex items-center gap-1 rounded-full bg-primary px-2 py-1 text-xs font-medium text-primary-foreground shadow-sm">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="12"
          height="12"
          viewBox="0 0 24 24"
          fill="currentColor"
          stroke="none"
        >
          <path d="M16 3a3 3 0 0 0-2.12.88L10.5 7.25l-.35-.35a2 2 0 0 0-2.83 0l-.7.7a2 2 0 0 0 0 2.83l.35.35-4.62 4.62a2 2 0 0 0-.45 2.1l-1.49 1.49a1 1 0 1 0 1.42 1.42l1.49-1.49a2 2 0 0 0 2.1-.45l4.62-4.62.35.35a2 2 0 0 0 2.83 0l.7-.7a2 2 0 0 0 0-2.83l-.35-.35 3.38-3.37A3 3 0 0 0 16 3Z" />
        </svg>
        <span>Pinned</span>
      </div>
    )
  }

  {
    heroImage && (
      <a
        href={`/blog/${post.slug}`}
        class={`relative block overflow-hidden ${
          variant === 'compact' ? 'mb-4 h-32' : 'mb-6 h-48'
        }`}
      >
        <Image
          src={heroImage}
          alt={title}
          class="h-full w-full object-cover transition-transform duration-300 group-hover:scale-105"
          width={variant === 'compact' ? 400 : 600}
          height={variant === 'compact' ? 200 : 300}
          data-no-lightbox="true"
        />
      </a>
    )
  }

  <div class="space-y-3">
    <div class="flex items-center gap-2 text-sm text-muted-foreground">
      <time datetime={publishedAt.toISOString()}>
        {formatDate(publishedAt)}
      </time>
      <span>â€¢</span>
      <span>{category}</span>
    </div>

    <h3
      class={`font-bold leading-tight ${
        variant === 'compact' ? 'text-lg' : 'text-xl'
      }`}
    >
      <a
        href={`/blog/${post.slug}`}
        class="transition-colors hover:text-primary"
      >
        {title}
      </a>
    </h3>

    <p
      class={`text-muted-foreground ${
        variant === 'compact' ? 'text-sm line-clamp-2' : 'line-clamp-3'
      }`}
    >
      {description}
    </p>

    {
      tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-2">
          {tags.slice(0, variant === 'compact' ? 2 : 3).map((tag: string) => (
            <span class="inline-flex items-center rounded-full bg-secondary px-2.5 py-0.5 text-xs font-semibold text-secondary-foreground">
              {tag}
            </span>
          ))}
        </div>
      )
    }
  </div>
</article>
