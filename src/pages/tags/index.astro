---
import BaseLayout from '@/layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('blog');
const publishedPosts = posts.filter((post) => !post.data.draft);

const tagCounts = publishedPosts.reduce(
  (acc, post) => {
    post.data.tags.forEach((tag) => {
      acc[tag] = (acc[tag] || 0) + 1;
    });
    return acc;
  },
  {} as Record<string, number>
);

const tags = Object.entries(tagCounts)
  .sort(([, a], [, b]) => b - a)
  .map(([name, count]) => ({ name, count, slug: name.toLowerCase() }));
---

<BaseLayout
  title="Tags - Modern Astro Blog"
  description="Browse posts by tags and categories."
>
  <section class="container py-12">
    <div class="mx-auto mb-12 max-w-2xl text-center">
      <h1 class="text-4xl font-bold tracking-tight sm:text-5xl">Tags</h1>
      <p class="mt-4 text-lg text-muted-foreground">
        Explore posts organized by tags.
      </p>
    </div>

    <div class="flex flex-wrap justify-center gap-4">
      {
        tags.map((tag) => (
          <a
            href={`/tags/${tag.slug}`}
            class="group relative inline-flex items-center rounded-full border px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground"
          >
            <span>{tag.name}</span>
            <span class="ml-2 text-xs text-muted-foreground group-hover:text-accent-foreground">
              ({tag.count})
            </span>
          </a>
        ))
      }
    </div>
  </section>
</BaseLayout>
